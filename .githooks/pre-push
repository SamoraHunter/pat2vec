#!/usr/bin/env bash
# .githooks/pre-push
set -e  # exit on any failure

# Navigate to repository root (relative to the hook location)
cd "$(dirname "$0")/.."

# Relative path to Python in the venv
VENV_PYTHON="./pat2vec_env/bin/python"

if [ ! -x "$VENV_PYTHON" ]; then
    echo "Virtual environment Python not found at $VENV_PYTHON"
    exit 1
fi

# Generate __init__.py
echo "Generating pat2vec/__init__.py..."
"$VENV_PYTHON" generate_init.py > pat2vec/__init__.py

# Run tests with PYTHONPATH=.
echo "Running test suite under pat2vec/tests..."
PYTHONPATH=. "$VENV_PYTHON" -m pytest pat2vec/tests

echo "Running notebook tests..."
PYTHONPATH=. "$VENV_PYTHON" -m pytest notebooks/test_notebook.py

echo "All checks passed. Proceeding with push."
exit 0
