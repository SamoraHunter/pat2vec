#!/bin/bash
# .githooks/pre-commit

# Navigate to the repository root (relative to the hook location)
cd "$(dirname "$0")/.."

# Activate the virtual environment (if needed)
VENV_PATH=$(find . -type d -name "pat2vec_env")
if [ -n "$VENV_PATH" ]; then
  source "$VENV_PATH/bin/activate"
else
  echo "Virtual environment not found. Exiting."
  exit 1
fi

echo "Checking jupyter notebooks for outputs..."

# Get modified jupyter notebooks
modified_notebooks=$(git diff --cached --name-only --diff-filter=AM -- "*.ipynb" | sort -u)

if [ -z "$modified_notebooks" ]; then
    echo "No jupyter notebooks found during commit, will proceed."
else
    # Remove outputs and some metadata from modified notebooks
    for notebook in $modified_notebooks; do
        echo "Removing outputs and some metadata from: $notebook"
        nbstripout "$notebook"
        git add "$notebook"
    done
fi

exit 0